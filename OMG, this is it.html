<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>OneTouch - Created by Prince Koshy - Ver: 3.6 - Text Storage</title>
    <style>
        body {
            font-family: 'Arial', sans-serif;
            margin: 0;
            padding: 0;
            color: #333;
            display: flex;
        }

        .background {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-image: url('https://i.ibb.co/26LFmhX/nvidia-og-image-1200x630-1-1.webp');
            background-size: cover;
            background-position: center center;
            filter: blur(10px);
            /* Apply blur effect */
            z-index: -1;
            /* Send background behind other elements */
            animation: slideBackground 10s linear;
            /* Background animation */
        }

        @keyframes slideBackground {
            0% {
                background-position: 0 0;
                /* Start position */
            }

            50% {
                background-position: 100% 100%;
                /* End position */
            }

            100% {
                background-position: 50% 50%;
                /* Back to start position */
            }
        }

        .stop-animation {
            animation: none !important;
        }

        .content {
            display: flex;
            flex-direction: row;
            justify-content: space-between;
            align-items: flex-start;
            padding: 20px;
            width: 100%;
            max-width: 1700px;
            margin: auto;
            z-index: 1;
            /* Bring content above background */
        }

        h1 {
            text-align: center;
            padding: 20px;
            background-color: rgba(255, 255, 255, 0.8);
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
            font-size: 20px;
            /* Adjusted font size */
        }

        #container {
            flex: 1;
            margin-left: 20px;
            padding: 20px;
            background-color: rgba(255, 255, 255, 0.5);
            /* Adjusted opacity */
            backdrop-filter: blur(15px);
            /* Reduced blur radius */
            box-shadow: 0 0 10px rgba(0, 0, 0, 0.1);
        }

        #sidebar {
            flex-basis: 200px;
            padding: 20px;
            background-color: rgba(255, 255, 255, 0.5);
            /* Adjusted opacity */
            backdrop-filter: blur(15px);
            /* Reduced blur radius */
            box-shadow: 0 0 10px rgba(0, 0, 0, 0.1);
        }

        #sentences-container {
            display: flex;
            flex-wrap: wrap;
            /* Allow wrapping of flex items */
        }

        #edit-heading-input,
        #edit-sentence-input {
            width: 100%;
            margin: 10px 0;
        }

        #edit-heading-input {
            display: block;
            margin-bottom: 10px;
        }

        .sentence-block {
            width: calc(33.33% - 20px);
            /* Adjust width to fit three blocks in a row */
            margin: 10px 10px 10px 0;
            /* Adjust margin for spacing between blocks */
            padding: 15px;
            background-color: #ffffff;
            /* White background color */
            cursor: pointer;
            white-space: pre-wrap;
            /* Enable text wrapping */
            box-sizing: border-box;
            /* Include padding and border in the box's total width and height */
            border-radius: 5px;
            /* Add border radius for rounded corners */
            border: 2px solid #4CAF50;
            /* Greenish border */
            color: #333;
            /* Text color */
            height: 110px;
            /* Fixed height for the sentence block */
            overflow: hidden;
            /* Hide overflow content */
            transition: background-color 0.3s ease;
            /* Add transition effect for background color */
            position: relative;
            /* Add position relative to the sentence block */

        }

        .sentence-options {
            position: absolute;
            /* Position the three dots absolutely */
            top: 10px;
            /* Adjust top position */
            right: 10px;
            /* Adjust right position */
            cursor: pointer;
        }

        .sentence-block:hover {
            background-color: #f0f0f0;
            /* Change background color on hover */
        }

        #add-category {
            cursor: pointer;
            font-size: 18px;
            margin-bottom: 10px;
            color: #333;
            text-align: center;
        }

        .category.selected {
            background-color: #8fd156;
            color: black;
        }

        .modal {
            display: none;
            /* Hidden by default */
            position: fixed;
            /* Stay in place */
            z-index: 9999;
            /* Sit on top */
            left: 0;
            top: 0;
            width: 100%;
            /* Full width */
            height: 100%;
            /* Full height */
            overflow: auto;
            /* Enable scroll if needed */
            background-color: rgb(0, 0, 0);
            /* Fallback color */
            background-color: rgba(0, 0, 0, 0.4);
            /* Black w/ opacity */
        }

        /* Modal Content/Box */
        .modal-content {
            background-color: #fefefe;
            margin: 10% auto;
            padding: 25px;
            border: none;
            width: 80%;
            max-width: 600px;
            border-radius: 12px;
            box-shadow: 0 5px 25px rgba(0, 0, 0, 0.2);
            animation: popupFadeIn 0.3s ease-out;
            position: relative;
        }

        @media (max-width: 600px) {
            .modal-content {
                width: 95%;
            }
        }

        /* Close Button */
        .close {
            color: #aaa;
            float: right;
            font-size: 28px;
            font-weight: bold;
        }

        .close:hover,
        .close:focus {
            color: black;
            text-decoration: none;
            cursor: pointer;
        }

        #categories-container {
            max-height: none;
            overflow-y: auto;
        }

        #add-category-form {
            display: none;
        }

        /* Removed #add-sentence-form styles as it is now a modal */

        #overlay {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.5);
            justify-content: center;
            align-items: center;
        }

        #popup-box {
            background: #fff;
            padding: 25px;
            width: 400px;
            max-width: 90%;
            text-align: center;
            border-radius: 12px;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.3);
            position: relative;
            animation: popupFadeIn 0.3s ease-out;
        }

        @keyframes popupFadeIn {
            from {
                transform: scale(0.8);
                opacity: 0;
            }

            to {
                transform: scale(1);
                opacity: 1;
            }
        }

        #full-sentence {
            text-align: left;
            margin-bottom: 20px;
            max-height: 200px;
            overflow-y: auto;
            background-color: #f9f9f9;
            padding: 15px;
            border-radius: 8px;
            border: 1px solid #eee;
            line-height: 1.6;
            font-size: 15px;
            color: #444;
            white-space: pre-wrap;
        }

        .popup-buttons {
            display: flex;
            justify-content: space-around;
            gap: 10px;
            flex-wrap: wrap;
        }

        .popup-btn {
            padding: 8px 16px;
            border: none;
            border-radius: 6px;
            cursor: pointer;
            font-size: 14px;
            font-weight: bold;
            transition: transform 0.1s, box-shadow 0.2s;
            color: white;
            flex: 1;
            min-width: 80px;
        }

        .popup-btn:active {
            transform: scale(0.95);
        }

        .btn-copy {
            background-color: #2196F3;
        }

        /* Blue */
        .btn-copy:hover {
            background-color: #1976D2;
            box-shadow: 0 2px 5px rgba(33, 150, 243, 0.3);
        }

        .btn-edit {
            background-color: #FF9800;
        }

        /* Orange */
        .btn-edit:hover {
            background-color: #F57C00;
            box-shadow: 0 2px 5px rgba(255, 152, 0, 0.3);
        }

        .btn-delete {
            background-color: #f44336;
        }

        /* Red */
        .btn-delete:hover {
            background-color: #d32f2f;
            box-shadow: 0 2px 5px rgba(244, 67, 54, 0.3);
        }

        .btn-close {
            background-color: #9E9E9E;
        }

        /* Gray */
        .btn-close:hover {
            background-color: #757575;
            box-shadow: 0 2px 5px rgba(158, 158, 158, 0.3);
        }

        .category {
            margin: 10px 0;
            padding: 15px;
            background-color: #b0e57c;
            cursor: pointer;
            font-weight: bold;
        }

        .category:hover {
            background-color: #8fd156;
        }

        .heading-container {
            display: flex;
            justify-content: center;
            /* Center the items horizontally */
            align-items: center;
        }

        .main-title {
            margin-right: auto;
            /* Push the main title to the left */
            margin-left: auto;
            /* Push the main title to the right */
        }

        .creator-info {
            position: absolute;
            /* Position the creator info absolutely */
            top: 10px;
            /* Adjust top position */
            right: 10px;
            /* Adjust right position */
            font-size: 12px;
            /* Adjust font size */
            color: #666;
            /* Adjust color */
        }

        #category-list {
            display: none;
            /* Hide the category list by default */
        }

        .popup {
            position: fixed;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            background-color: #4CAF50;
            color: white;
            padding: 15px;
            border-radius: 5px;
            animation: popupAnimation 2s ease-out;
            z-index: 9999;
            /* Set a high z-index value */
        }

        @keyframes popupAnimation {
            0% {
                opacity: 1;
            }

            100% {
                opacity: 0;
            }
        }

        /* Removed old #backup-restore, #toggle-container, #search-container logic references if any remain in CSS */

        #toggle-expand {
            -webkit-appearance: none;
            -moz-appearance: none;
            appearance: none;
            width: 40px;
            height: 20px;
            background-color: #ccc;
            border-radius: 20px;
            outline: none;
            position: relative;
            cursor: pointer;
            display: block;
            margin: auto;
        }

        #toggle-expand:checked {
            background-color: #4CAF50;
        }

        #toggle-expand::before {
            content: '';
            position: absolute;
            width: 18px;
            height: 18px;
            background-color: #fff;
            border-radius: 50%;
            top: 1px;
            left: 1px;
            transition: 0.3s;
        }

        #toggle-expand:checked::before {
            left: 21px;
        }

        /* Removed #search-container styles */


        #edit-sentence-input,
        #new-sentence-input-modal {
            min-height: 300px;
            resize: vertical;
        }

        #new-heading-input-modal,
        #new-sentence-input-modal,
        #edit-heading-input,
        #edit-sentence-input {
            width: 100%;
            margin: 10px 0 20px 0;
            display: block;
            padding: 12px;
            border: 1px solid #ddd;
            border-radius: 6px;
            box-sizing: border-box;
            font-size: 14px;
            font-family: inherit;
            transition: border-color 0.3s;
        }

        #new-heading-input-modal:focus,
        #new-sentence-input-modal:focus,
        #edit-heading-input:focus,
        #edit-sentence-input:focus {
            outline: none;
            border-color: #4CAF50;
        }

        /* Modal Buttons */
        .modal-content button {
            background-color: #4CAF50;
            color: white;
            padding: 12px 20px;
            border: none;
            border-radius: 6px;
            cursor: pointer;
            width: 100%;
            font-size: 16px;
            font-weight: bold;
            transition: background-color 0.3s;
        }

        .modal-content button:hover {
            background-color: #45a049;
        }

        /* Styles for the new "Add note" button */
        #add-sentence-btn {
            background-color: #4CAF50;
            color: white;
            padding: 6px 14px;
            /* Reduced padding */
            border: none;
            border-radius: 4px;
            cursor: pointer;
            font-size: 13px;
            /* Reduced font size */
            font-weight: bold;
            margin-bottom: 0;
            display: inline-block;
            transition: background-color 0.3s, transform 0.1s;
        }

        #add-sentence-btn:hover {
            background-color: #45a049;
            transform: translateY(-1px);
        }

        #add-sentence-btn:active {
            transform: translateY(0);
        }

        /* Removed #new-heading-input-modal styles as they are covered above */
        /* Undo Toast Notification */
        #undo-toast {
            visibility: hidden;
            min-width: 280px;
            background-color: #333;
            color: #fff;
            text-align: center;
            border-radius: 8px;
            padding: 16px;
            position: fixed;
            z-index: 10000;
            right: 20px;
            bottom: 30px;
            font-size: 15px;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.3);
            display: flex;
            justify-content: space-between;
            align-items: center;
            opacity: 0;
            transition: opacity 0.5s, bottom 0.5s;
        }

        #undo-toast.show {
            visibility: visible;
            opacity: 1;
            bottom: 30px;
        }

        #undo-btn {
            background-color: transparent;
            color: #4CAF50;
            border: 1px solid #4CAF50;
            padding: 5px 10px;
            border-radius: 4px;
            cursor: pointer;
            font-weight: bold;
            margin-left: 15px;
            font-size: 13px;
            transition: background-color 0.2s;
        }

        #undo-btn:hover {
            background-color: rgba(76, 175, 80, 0.1);
        }

        #undo-timer {
            font-weight: bold;
            color: #aaa;
            margin-left: 8px;
            width: 20px;
            display: inline-block;
            text-align: left;
        }

        /* Settings Modal Styles */
        #settings-modal .modal-content {
            display: flex;
            padding: 0;
            height: 450px;
            overflow: hidden;
            width: 700px;
            max-width: 95%;
        }

        .settings-sidebar {
            width: 180px;
            background-color: #f5f5f5;
            border-right: 1px solid #ddd;
            padding: 20px 0;
            display: flex;
            flex-direction: column;
        }

        /* Settings Tabs Base Styles */
        .settings-tab {
            padding: 12px 20px;
            cursor: pointer;
            font-weight: 500;
            color: #555;
            transition: background-color 0.2s;
            text-align: left;
            border: none;
            background-color: #BBDEFB !important;
            /* Material Blue 100 - Inactive */
            width: 100%;
            margin-bottom: 2px;
        }

        .settings-tab:hover {
            background-color: #90CAF9 !important;
            /* Material Blue 200 - Hover */
        }

        /* Active State - Unified Blue */
        .settings-tab.active,
        #tab-general.active,
        #tab-appearance.active {
            color: #fff !important;
            font-weight: bold;
            background-color: #2196F3 !important;
            /* Hard Blue - Forced */
            border-left: 4px solid #1976D2 !important;
        }

        /* Ensure no green remains by explicitly overriding potential old ID rules */
        #tab-general,
        #tab-appearance {
            background-color: #51b840 !important;
        }



        .settings-close-btn {
            position: absolute;
            bottom: 20px;
            right: 20px;
            top: auto;
            /* Reset top */
            background-color: #b0e57c !important;
            /* Light green forced */
            color: #333 !important;
            border: none;
            padding: 8px 20px;
            border-radius: 4px;
            cursor: pointer;
            font-weight: bold;
            transition: background-color 0.2s;
            z-index: 100;
            width: auto !important;
            /* Prevent 100% width inheritance */
        }

        .settings-close-btn:hover {
            background-color: #9cd16a !important;
        }

        .settings-body {
            flex: 1;
            padding: 25px;
            overflow-y: auto;
        }

        .settings-section {
            display: none;
            animation: fadeIn 0.3s;
        }

        .settings-section.active {
            display: block;
        }

        .settings-section h3 {
            margin-top: 0;
            margin-bottom: 20px;
            border-bottom: 1px solid #eee;
            padding-bottom: 10px;
            color: #333;
        }

        /* Background Grid */
        .bg-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(100px, 1fr));
            gap: 15px;
            margin-bottom: 25px;
        }

        .bg-tile {
            height: 70px;
            border-radius: 6px;
            cursor: pointer;
            border: 3px solid transparent;
            overflow: hidden;
            position: relative;
            background-size: cover;
            background-position: center;
            transition: transform 0.2s;
        }

        .bg-tile:hover {
            transform: scale(1.03);
        }

        .bg-tile.selected {
            border-color: #4CAF50;
            box-shadow: 0 0 8px rgba(76, 175, 80, 0.4);
        }

        .bg-tile-add {
            background-color: #eee;
            display: flex;
            align-items: center;
            justify-content: center;
            flex-direction: column;
            color: #666;
            font-size: 12px;
            text-align: center;
        }

        .bg-tile-add span {
            font-size: 24px;
            line-height: 1;
            margin-bottom: 5px;
        }

        /* Top Control Bar */
        #top-control-bar {
            display: flex;
            align-items: center;
            justify-content: space-between;
            background-color: rgba(255, 255, 255, 0.9);
            padding: 5px 15px;
            border-radius: 8px;
            margin-bottom: 20px;
            box-shadow: 0 2px 5px rgba(0, 0, 0, 0.05);
            flex-wrap: wrap;
            gap: 10px;
        }

        .right-controls {
            display: flex;
            align-items: center;
            gap: 12px;
        }

        /* Settings Button */
        #settings-btn {
            background: none;
            border: none;
            cursor: pointer;
            font-size: 20px;
            color: #555;
            padding: 5px;
            border-radius: 50%;
            transition: background-color 0.2s, transform 0.2s;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        #settings-btn:hover {
            background-color: #eee;
            transform: rotate(30deg);
        }

        /* Responsive adjustments for Top Bar */
        @media (max-width: 600px) {
            #top-control-bar {
                justify-content: center;
            }

            .right-controls {
                width: 100%;
                justify-content: center;
                flex-wrap: wrap;
            }
        }

        /* Blur Slider */
        input[type=range] {
            width: 100%;
            margin: 10px 0;
        }

        .url-input-group {
            display: flex;
            gap: 10px;
            margin-top: 10px;
            display: none;
            /* Hidden by default */
        }
    </style>
</head>

<body>
    <div class="background"></div> <!-- Background element -->
    <div class="content">
        <div id="sidebar">
            <div id="add-category">+ Add Category</div>
            <div id="add-category-form">
                <input type="text" id="new-category-input" placeholder="Enter category name">
                <button onclick="addCategory()">Add</button>
                <button onclick="cancelAddCategory()">Cancel</button>
            </div>
            <div id="categories-container" ondrop="dropCategory(event)" ondragover="allowDropCategory(event)">
                <!-- Categories will be dynamically generated here -->
            </div>
            <div id="category-options" style="display: none;">
                <button class="category-option" onclick="deleteCategory()">Delete</button>
                <button class="category-option" onclick="renameCategory()">Rename</button>
            </div>
        </div>
        <div id="rename-category-modal" class="modal">
            <div class="modal-content">
                <span class="close" onclick="closeRenameCategoryModal()">&times;</span>
                <input type="text" id="new-category-name" placeholder="Enter new category name">
                <button onclick="confirmRenameCategory()">Rename</button>
            </div>
        </div>
        <div id="container">
            <h1 class="heading-container">
                <span class="main-title">OneTouch - Ver: 3.6</span>
            </h1>
            <div class="creator-info">Created by: Prince Koshy</div>
            </h1>
            <div class="creator-info">Created by: Prince Koshy</div>
            </h1>

            <!-- New Top Control Bar -->
            <div id="top-control-bar">
                <!-- Left: Add Note Button (moved here) -->
                <button id="add-sentence-btn" onclick="openAddSentenceModal()">Add note</button>

                <!-- Right: Controls -->
                <div class="right-controls">
                    <!-- Toggle Expand -->
                    <div class="toggle-wrapper" title="Toggle Expand"
                        style="display: flex; align-items: center; gap: 8px;">
                        <span style="font-size: 14px; font-weight: bold; color: #555;">Expand Blocks</span>
                        <input type="checkbox" id="toggle-expand" onchange="toggleExpand()" style="margin: 0;">
                    </div>

                    <!-- Search -->
                    <div class="search-wrapper" style="display: flex; align-items: center; gap: 5px;">
                        <input type="text" id="search-input" placeholder="Search..."
                            style="width: 120px; padding: 6px; border-radius: 4px; border: 1px solid #ccc;">
                        <button onclick="searchSentences()"
                            style="padding: 6px 10px; cursor: pointer; background: #eee; border: 1px solid #ccc; border-radius: 4px;">&#128269;</button>
                    </div>

                    <!-- Settings Button -->
                    <button id="settings-btn" onclick="openSettingsModal()" title="Settings">&#9881;</button>
                </div>
            </div>

            <div id="sentences-container" ondrop="drop(event)" ondragover="allowDrop(event)"></div>
            <div id="overlay" onclick="closePopup()">
                <div id="popup-box" onclick="event.stopPropagation()">
                    <!-- Stop propagation to prevent closing when clicking inside box -->
                    <div id="full-sentence"></div>
                    <div class="popup-buttons">
                        <button class="popup-btn btn-copy" onclick="copyToClipboardPopup()">Copy</button>
                        <button class="popup-btn btn-edit" onclick="editSentence()">Edit</button>
                        <button class="popup-btn btn-delete" onclick="deleteSentence()">Delete</button>
                        <button class="popup-btn btn-close" onclick="closePopup()">Close</button>
                    </div>
                </div>
            </div>

            <!-- Undo Toast Notification -->
            <div id="undo-toast">
                <span>Item deleted <span id="undo-timer">5</span>s</span>
                <button id="undo-btn" onclick="undoDelete()">UNDO</button>
            </div>
        </div>
    </div>
    <div id="edit-sentence-modal" class="modal">
        <div class="modal-content">
            <span class="close" onclick="closeEditSentenceModal()">&times;</span>
            <input type="text" id="edit-heading-input" placeholder="Edit heading">
            <textarea id="edit-sentence-input" placeholder="Edit your text"></textarea>
            <button onclick="saveEditedSentence()">Save</button>
        </div>
    </div>

    <!-- New Modal for Adding Sentences -->
    <div id="add-sentence-modal" class="modal">
        <div class="modal-content">
            <span class="close" onclick="closeAddSentenceModal()">&times;</span>
            <input type="text" id="new-heading-input-modal" placeholder="Enter heading (optional)">
            <textarea id="new-sentence-input-modal" placeholder="Enter your text"></textarea>
            <button onclick="saveSentence()">Add Note</button>
        </div>
    </div>

    <!-- Settings Modal -->
    <div id="settings-modal" class="modal">
        <div class="modal-content">
            <div class="settings-sidebar">
                <button id="tab-general" class="settings-tab active" onclick="switchTab('general')">General</button>
                <button id="tab-appearance" class="settings-tab" onclick="switchTab('appearance')">Appearance</button>
                <div style="flex: 1;"></div>
            </div>
            <!-- Close Button moved here -->
            <button class="settings-close-btn" onclick="closeSettingsModal()">Close</button>
            <div class="settings-body">
                <!-- General Section -->
                <div id="settings-general" class="settings-section active">
                    <h3>General Settings</h3>
                    <p>Manage your data</p>
                    <div style="display: flex; gap: 10px; flex-wrap: wrap;">
                        <button onclick="backupData()"
                            style="padding: 10px; background-color: #4CAF50; color: white; border: none; border-radius: 4px; cursor: pointer;">Backup
                            Data</button>
                        <button onclick="restoreData()"
                            style="padding: 10px; background-color: #2196F3; color: white; border: none; border-radius: 4px; cursor: pointer;">Restore
                            Data</button>
                    </div>
                </div>

                <!-- Appearance Section -->
                <div id="settings-appearance" class="settings-section">
                    <h3>Appearance</h3>

                    <label style="display: block; margin-bottom: 10px; font-weight: bold;">Background Blur</label>
                    <div style="display: flex; align-items: center; justify-content: space-between;">
                        <input type="range" id="blur-slider" min="0" max="20" value="5" oninput="changeBlur(this.value)"
                            style="flex: 1; margin-right: 15px;">
                        <span id="blur-value"
                            style="width: 40px; text-align: right; font-weight: bold; color: #555;">5px</span>
                    </div>

                    <label style="display: block; margin-top: 20px; margin-bottom: 10px; font-weight: bold;">Background
                        Image</label>
                    <div id="bg-grid" class="bg-grid">
                        <!-- Tiles generated by JS -->
                    </div>

                    <!-- URL Input Group (Hidden by default) -->
                    <div id="url-input-group" class="url-input-group">
                        <input type="text" id="bg-url-input" placeholder="Paste image URL here..."
                            style="flex: 1; padding: 8px; border: 1px solid #ddd; border-radius: 4px; min-height: unset; resize: none;">
                        <button onclick="saveBackgroundFromUrl()"
                            style="padding: 8px 15px; background-color: #4CAF50; color: white; border: none; border-radius: 4px; cursor: pointer;">Add</button>
                    </div>
                </div>
            </div>
        </div>
    </div>


    <script>
        let sentences = JSON.parse(localStorage.getItem('sentences')) || {};
        let categories = JSON.parse(localStorage.getItem('categories')) || [];
        let currentCategoryIndex = 0;
        let currentSelectedCategory = null;
        let expandEnabled = false;
        let currentEditIndex = null;

        function editSentence() {
            const overlay = document.getElementById("overlay");
            const index = parseInt(overlay.dataset.sentenceIndex);
            const catIndex = parseInt(overlay.dataset.categoryIndex);

            if (!isNaN(index) && !isNaN(catIndex)) {
                currentEditIndex = index;
                // Store category index heavily to know where to save back
                overlay.dataset.editCategoryIndex = catIndex;

                const currentCategory = categories[catIndex];
                const currentSentence = sentences[currentCategory][currentEditIndex];

                const headingEnd = currentSentence.indexOf(": ");
                if (headingEnd !== -1) {
                    const heading = currentSentence.substring(0, headingEnd);
                    const sentencePart = currentSentence.substring(headingEnd + 2);
                    document.getElementById('edit-heading-input').value = heading;
                    document.getElementById('edit-sentence-input').value = sentencePart;
                } else {
                    document.getElementById('edit-heading-input').value = "";
                    // Clear ZWS for clean editing
                    document.getElementById('edit-sentence-input').value = currentSentence.replace(/\u200B/g, "");
                }

                document.getElementById('edit-sentence-modal').style.display = 'block';
                closePopup();
            }
        }

        function saveEditedSentence() {
            const editedHeading = document.getElementById('edit-heading-input').value.trim();
            const editedSentence = document.getElementById('edit-sentence-input').value.trim();

            let newBlockContent = editedSentence;
            if (editedHeading !== "") {
                newBlockContent = editedHeading + ': ' + editedSentence;
            } else {
                // Determine if we need to escape colons to prevent auto-heading
                // Replace ": " with ":\u200B " to break the legacy splitter
                newBlockContent = editedSentence.replace(/: /g, ":\u200B ");
            }

            if (newBlockContent !== "") {
                const overlay = document.getElementById("overlay");
                // Use the stored category index or default to current (fallback)
                let catIndex = parseInt(overlay.dataset.editCategoryIndex);
                if (isNaN(catIndex)) catIndex = currentCategoryIndex;

                const currentCategory = categories[catIndex];
                sentences[currentCategory][currentEditIndex] = newBlockContent;
                localStorage.setItem('sentences', JSON.stringify(sentences));

                // If we are viewing the same category, re-render
                if (catIndex === currentCategoryIndex) {
                    renderSentences();
                } else {
                    // If we edited a search result from another category, we might want to re-search or just save.
                    // For now, let's just save. If in search view, maybe re-search?
                    // Simplest: If search input has value, re-search.
                    const searchVal = document.getElementById("search-input").value;
                    if (searchVal) {
                        searchSentences();
                    }
                }
                closeEditSentenceModal();
            }
        }
        function closeEditSentenceModal() {
            document.getElementById('edit-sentence-modal').style.display = 'none';
        }
        function toggleExpand() {
            expandEnabled = !expandEnabled;
            renderSentences();
        }

        function searchSentences() {
            const searchInput = document.getElementById("search-input").value.toLowerCase();

            const container = document.getElementById("sentences-container");
            container.innerHTML = ""; // Clear previous search results

            // Iterate over all categories
            categories.forEach((category, catIndex) => {
                const categorySentences = sentences[category] || [];

                categorySentences.forEach((sentence, originalIndex) => {
                    if (sentence.toLowerCase().includes(searchInput)) {
                        const block = document.createElement("div");
                        block.className = "sentence-block";

                        // Check if expand is enabled and adjust height accordingly
                        if (expandEnabled) {
                            block.style.height = "auto"; // Set height to auto to expand based on content
                        } else {
                            block.style.height = "110px"; // Default height
                        }

                        // Check if there's a heading present in the sentence
                        const headingEnd = sentence.indexOf(": ");
                        if (headingEnd !== -1) {
                            // If heading exists, split the sentence into heading and sentence part
                            const heading = sentence.substring(0, headingEnd + 2);
                            const sentencePart = sentence.substring(headingEnd + 2);

                            // Create separate elements for heading and sentence part
                            const headingElement = document.createElement("span");
                            headingElement.textContent = heading;
                            headingElement.style.fontWeight = "bold"; // Make the heading bold

                            const sentenceElement = document.createElement("span");
                            sentenceElement.textContent = sentencePart;

                            // Append both elements to the block
                            block.appendChild(headingElement);
                            block.appendChild(sentenceElement);
                        } else {
                            // If no heading, simply create a single element for the entire sentence
                            block.textContent = sentence;
                        }

                        // Create three dots element
                        const options = document.createElement("span");
                        options.className = "sentence-options";
                        options.innerHTML = "&#8230;";
                        // Pass ORIGINAL category index and sentence index
                        options.addEventListener("click", (event) => showOptions(event, originalIndex, catIndex));
                        block.appendChild(options);

                        // Add event listener to copy sentence when clicking on the block (except the three dots)
                        block.addEventListener("click", (event) => {
                            if (!event.target.classList.contains('sentence-options')) {
                                copyToClipboard(sentence); // Pass the actual sentence to copy
                            }
                        });

                        // Add drag event listener to the sentence block
                        block.setAttribute("draggable", true);
                        block.addEventListener("dragstart", (event) => drag(event, originalIndex)); // Note: Dragging from search results might need more work for reordering across categories, but keeping basic drag for now.

                        container.appendChild(block);
                    }
                });
            });
        }



        function renderCategories() {
            const container = document.getElementById("categories-container");
            container.innerHTML = "";
            categories.forEach((category, index) => {
                const block = document.createElement("div");
                block.className = "category";
                block.draggable = true;
                block.setAttribute("ondragstart", `dragCategory(event, ${index})`);
                block.textContent = category;
                // Add event listener for category selection
                block.addEventListener("click", () => selectCategory(index));
                // Apply selected class if this category is currently selected
                if (index === currentSelectedCategory) {
                    block.classList.add("selected");
                }
                container.appendChild(block);
            });
        }

        function addCategory() {
            const newCategory = document.getElementById("new-category-input").value.trim();
            if (newCategory !== "") {
                categories.push(newCategory);
                sentences[newCategory] = [];
                localStorage.setItem('categories', JSON.stringify(categories));
                localStorage.setItem('sentences', JSON.stringify(sentences));
                renderCategories();
                document.getElementById("new-category-input").value = "";
                document.getElementById("add-category-form").style.display = "none";
            }
        }


        document.getElementById("add-category").addEventListener("click", () => {
            document.getElementById("add-category-form").style.display = "block";
        });

        function saveSentence() {
            const newHeading = document.getElementById("new-heading-input-modal").value.trim();
            const newSentence = document.getElementById("new-sentence-input-modal").value.trim();
            const currentCategory = categories[currentCategoryIndex];

            let newBlockContent = newSentence;
            if (newHeading !== "") {
                newBlockContent = newHeading + ': ' + newSentence;
            } else {
                // Zero-width space insertion to prevent auto-heading detection
                newBlockContent = newSentence.replace(/: /g, ":\u200B ");
            }

            if (newBlockContent !== "") {
                sentences[currentCategory].push(newBlockContent);
                localStorage.setItem('sentences', JSON.stringify(sentences));
                renderSentences();
                document.getElementById("new-heading-input-modal").value = "";
                document.getElementById("new-sentence-input-modal").value = "";
                closeAddSentenceModal();
            }
        }

        // --- Settings & UI Logic ---

        // Default Settings
        const defaultSettings = {
            blur: 5,
            backgrounds: [
                "https://i.ibb.co/26LFmhX/nvidia-og-image-1200x630-1-1.webp",
                "https://i.ibb.co/5gM0kgtG/uwp4975770.jpg",
                "https://i.ibb.co/tp33y9X6/Pngtree-top-view-of-computer-graphics-15553159.jpg"
            ],
            currentBackground: "https://i.ibb.co/26LFmhX/nvidia-og-image-1200x630-1-1.webp"
        };

        let appSettings = JSON.parse(localStorage.getItem('appSettings')) || defaultSettings;

        // Initialize App
        window.addEventListener('DOMContentLoaded', () => {
            renderCategories();
            renderSentences();
            loadSettings();
        });

        function loadSettings() {
            // Apply Background
            document.querySelector('.background').style.backgroundImage = `url('${appSettings.currentBackground}')`;

            // Apply Blur
            changeBlur(appSettings.blur, false);
            document.getElementById('blur-slider').value = appSettings.blur;
            document.getElementById('blur-value').textContent = appSettings.blur + 'px';

            // Render Background Tiles
            renderBackgroundGrid();
        }

        function saveSettings() {
            localStorage.setItem('appSettings', JSON.stringify(appSettings));
        }

        function openSettingsModal() {
            document.getElementById('settings-modal').style.display = 'block';
            renderBackgroundGrid(); // Refresh grid
        }

        function closeSettingsModal() {
            document.getElementById('settings-modal').style.display = 'none';
        }

        function switchTab(tabName) {
            // Update Tab Buttons
            document.querySelectorAll('.settings-tab').forEach(tab => {
                tab.classList.remove('active');
            });
            event.target.classList.add('active');

            // Show Section
            document.querySelectorAll('.settings-section').forEach(section => {
                section.classList.remove('active');
            });
            document.getElementById('settings-' + tabName).classList.add('active');
        }

        function changeBlur(value, save = true) {
            const bg = document.querySelector('.background');
            const blurValue = `blur(${value}px) brightness(0.9)`; // Keep brightness consistent
            // Note: filter might overwrite brightness if not careful. 
            // In original CSS: filter: blur(8px) brightness(0.9);
            bg.style.filter = blurValue;

            document.getElementById('blur-value').textContent = value + 'px';

            if (save) {
                appSettings.blur = value;
                saveSettings();
            }
        }

        function changeBackground(url) {
            appSettings.currentBackground = url;
            document.querySelector('.background').style.backgroundImage = `url('${url}')`;
            saveSettings();
            renderBackgroundGrid(); // Update selected state
        }

        function renderBackgroundGrid() {
            const grid = document.getElementById('bg-grid');
            grid.innerHTML = '';

            // Render Presets
            appSettings.backgrounds.forEach(url => {
                const tile = document.createElement('div');
                tile.className = 'bg-tile ' + (url === appSettings.currentBackground ? 'selected' : '');
                tile.style.backgroundImage = `url('${url}')`;
                tile.onclick = () => changeBackground(url);
                grid.appendChild(tile);
            });

            // "Add From URL" Tile
            const addTile = document.createElement('div');
            addTile.className = 'bg-tile bg-tile-add';
            addTile.innerHTML = '<span>+</span>Add from URL';
            addTile.onclick = () => {
                const inputGroup = document.getElementById('url-input-group');
                inputGroup.style.display = inputGroup.style.display === 'flex' ? 'none' : 'flex';
            };
            grid.appendChild(addTile);
        }

        function saveBackgroundFromUrl() {
            const input = document.getElementById('bg-url-input');
            const url = input.value.trim();

            if (url) {
                appSettings.backgrounds.push(url);
                changeBackground(url); // Select it immediately
                saveSettings();
                input.value = '';
                document.getElementById('url-input-group').style.display = 'none';
            }
        }

        // --- Updated Toggle & Search Logic ---

        function toggleExpand() {
            const checkbox = document.getElementById("toggle-expand");
            expandEnabled = checkbox.checked;
            renderSentences(); // Re-render to apply height changes
        }

        function searchSentences() {
            const query = document.getElementById("search-input").value.trim().toLowerCase();
            const container = document.getElementById("sentences-container");
            container.innerHTML = "";
            const currentCategory = categories[currentCategoryIndex];

            // Use ALL sentences if searching, or just current category
            // Requirement says "logic unchanged", but usually search searches everything.
            // The original code passed `catIndex` dynamically.
            // Let's search ALL categories to be useful, or stick to current if that's desired.
            // Original `searchSentences` logic was:

            if (query === "") {
                renderSentences();
                return;
            }

            categories.forEach((category, catIndex) => {
                const categorySentences = sentences[category] || [];
                categorySentences.forEach((sentence, index) => {
                    if (sentence.toLowerCase().includes(query)) {
                        const block = document.createElement("div");
                        block.className = "sentence-block";
                        block.id = `sentence-${catIndex}-${index}`; // Unique ID

                        // ... (Rest of rendering logic similar to renderSentences)
                        // Simplified for brevity, usually we'd refactor `createSentenceBlock`
                        // But I will copy-paste the rendering logic to ensure exact behavior

                        if (expandEnabled) {
                            block.style.height = "auto";
                        } else {
                            block.style.height = "110px";
                        }

                        // Highlight match
                        // For simplicity in this step, just render text. 
                        // To keep "logic unchanged", I should reuse the exact block creation code.

                        // Check if header exists
                        const headingEnd = sentence.indexOf(": ");
                        if (headingEnd !== -1) {
                            const heading = sentence.substring(0, headingEnd + 2);
                            const sentencePart = sentence.substring(headingEnd + 2);

                            const headingElement = document.createElement("span");
                            headingElement.textContent = heading;
                            headingElement.style.fontWeight = "bold";

                            const sentenceElement = document.createElement("span");
                            sentenceElement.textContent = sentencePart;

                            block.appendChild(headingElement);
                            block.appendChild(sentenceElement);
                        } else {
                            block.textContent = sentence;
                        }

                        const options = document.createElement("span");
                        options.className = "sentence-options";
                        options.innerHTML = "&#8230;";
                        options.addEventListener("click", (event) => showOptions(event, index, catIndex));
                        block.appendChild(options);

                        block.addEventListener("click", (event) => {
                            if (!event.target.classList.contains("sentence-options")) {
                                copyToClipboard(sentence);
                                showPopup(sentence, index);
                            }
                        });


                        container.appendChild(block);
                    }
                });
            });
        }


        function closeAddSentenceModal() {
            document.getElementById("add-sentence-modal").style.display = "none";
        }

        function renderSentences() {
            const container = document.getElementById("sentences-container");
            container.innerHTML = ""; // Clear previous sentences

            const currentCategory = categories[currentCategoryIndex];
            const categorySentences = sentences[currentCategory] || [];

            categorySentences.forEach((sentence, index) => {
                const block = document.createElement("div");
                block.className = "sentence-block";
                block.id = `sentence-${index}`;
                block.draggable = true;
                block.ondragstart = drag;

                if (expandEnabled) {
                    block.style.height = "auto";
                } else {
                    block.style.height = "110px";
                }

                const headingEnd = sentence.indexOf(": ");
                if (headingEnd !== -1) {
                    const heading = sentence.substring(0, headingEnd + 2);
                    const sentencePart = sentence.substring(headingEnd + 2);

                    const headingElement = document.createElement("span");
                    headingElement.textContent = heading;
                    headingElement.style.fontWeight = "bold";

                    const sentenceElement = document.createElement("span");
                    sentenceElement.textContent = sentencePart;

                    block.appendChild(headingElement);
                    block.appendChild(sentenceElement);
                } else {
                    block.textContent = sentence;
                }

                const options = document.createElement("span");
                options.className = "sentence-options";
                options.innerHTML = "&#8230;";
                // Pass currentCategoryIndex explicitly
                options.addEventListener("click", (event) => showOptions(event, index, currentCategoryIndex));
                block.appendChild(options);

                block.addEventListener("click", (event) => {
                    if (!event.target.classList.contains("sentence-options")) {
                        copyToClipboard(sentence);
                        showPopup(sentence, index);
                    }
                });

                container.appendChild(block);
            });
        }



        function allowDrop(event) {
            event.preventDefault();
        }

        function drop(event) {
            event.preventDefault();
            const data = event.dataTransfer.getData("text");
            const draggedElement = document.getElementById(data);

            // Find the closest sentence-block container
            const closestBlock = event.target.closest(".sentence-block");

            if (closestBlock) {
                // Insert the dragged element before the closest block
                closestBlock.insertAdjacentElement("beforebegin", draggedElement);
            } else {
                // If no closest block is found, append to the container
                document.getElementById("sentences-container").appendChild(draggedElement);
            }

            saveSentences();
        }

        function saveSentences() {
            const container = document.getElementById("sentences-container");
            const sentenceBlocks = container.querySelectorAll(".sentence-block");

            const currentCategory = categories[currentCategoryIndex];
            sentences[currentCategory] = Array.from(sentenceBlocks).map(block => {
                // Extract the text content excluding the ellipsis
                const options = block.querySelector(".sentence-options");
                if (options) {
                    options.remove(); // Remove the ellipsis span element before extracting text
                }
                return block.textContent.trim();
            });

            localStorage.setItem('sentences', JSON.stringify(sentences));
            renderSentences();
        }


        function closePopup() {
            const overlay = document.getElementById("overlay");
            overlay.style.display = "none";
        }

        // Variables to store deleted item
        let deletedItem = null;
        let deletedCategoryIndex = -1;
        let deletedSentenceIndex = -1;
        let undoTimeout;
        let undoInterval;
        let timeLeft = 5;

        function deleteSentence() {
            const overlay = document.getElementById("overlay");
            const index = parseInt(overlay.dataset.sentenceIndex);
            // Use category index from overlay
            const catIndex = parseInt(overlay.dataset.categoryIndex);

            if (!isNaN(index) && !isNaN(catIndex)) {
                const currentCategory = categories[catIndex];

                // Store deletion data
                deletedItem = sentences[currentCategory][index];
                deletedCategoryIndex = catIndex;
                deletedSentenceIndex = index;

                // Perform deletion
                sentences[currentCategory].splice(index, 1);
                localStorage.setItem('sentences', JSON.stringify(sentences));

                // Refresh UI
                if (catIndex === currentCategoryIndex && !document.getElementById("search-input").value) {
                    renderSentences();
                } else if (document.getElementById("search-input").value) {
                    searchSentences();
                } else {
                    renderSentences();
                }
                closePopup();

                // Show Undo Toast
                showUndoToast();
            }
        }

        function showUndoToast() {
            const toast = document.getElementById("undo-toast");
            const timerSpan = document.getElementById("undo-timer");

            // Clear existing timers
            clearTimeout(undoTimeout);
            clearInterval(undoInterval);

            timeLeft = 5;
            timerSpan.textContent = timeLeft;
            toast.className = "show";

            // Start countdown
            undoInterval = setInterval(() => {
                timeLeft--;
                timerSpan.textContent = timeLeft;
                if (timeLeft <= 0) {
                    clearInterval(undoInterval);
                }
            }, 1000);

            // Hide after 5 seconds
            undoTimeout = setTimeout(() => {
                toast.className = toast.className.replace("show", "");
                // Clear deletion data after timeout
                deletedItem = null;
                deletedCategoryIndex = -1;
                deletedSentenceIndex = -1;
            }, 5000);
        }

        function undoDelete() {
            if (deletedItem !== null && deletedCategoryIndex !== -1 && deletedSentenceIndex !== -1) {
                const toast = document.getElementById("undo-toast");

                // Restore logic
                const catName = categories[deletedCategoryIndex];
                sentences[catName].splice(deletedSentenceIndex, 0, deletedItem);
                localStorage.setItem('sentences', JSON.stringify(sentences));

                // Refresh UI
                if (deletedCategoryIndex === currentCategoryIndex && !document.getElementById("search-input").value) {
                    renderSentences();
                } else if (document.getElementById("search-input").value) {
                    searchSentences();
                } else {
                    renderSentences();
                }

                // Hide toast immediately
                clearTimeout(undoTimeout);
                clearInterval(undoInterval);
                toast.className = toast.className.replace("show", "");

                deletedItem = null;
                deletedCategoryIndex = -1;
                deletedSentenceIndex = -1;
            }
        }
        /* cancelAddSentence is no longer needed, replaced by closeAddSentenceModal */

        function getCurrentCategory() {
            return categories[currentCategoryIndex];
        }
        function drag(event) {
            event.dataTransfer.setData("text", event.target.id);
        }
        function allowDropCategory(event) {
            event.preventDefault();
        }

        function dragCategory(event, index) {
            event.dataTransfer.setData("text/plain", index);
        }

        function dropCategory(event) {
            event.preventDefault();
            const data = event.dataTransfer.getData("text/plain");
            const draggedIndex = parseInt(data);
            const dropIndex = Array.from(event.target.parentNode.children).indexOf(event.target);

            // Swap categories in the 'categories' array
            const temp = categories[draggedIndex];
            categories[draggedIndex] = categories[dropIndex];
            categories[dropIndex] = temp;

            localStorage.setItem('categories', JSON.stringify(categories));
            renderCategories(); // Re-render categories to reflect changes
        }

        // Attach the closePopup function to the overlay click event
        document.getElementById("overlay").addEventListener("click", closePopup);

        function showOptions(event, index, categoryIndex) {
            const overlay = document.getElementById("overlay");
            const fullSentence = document.getElementById("full-sentence");

            const targetCategoryIndex = (categoryIndex !== undefined) ? categoryIndex : currentCategoryIndex;
            const currentCategory = categories[targetCategoryIndex];
            const sentence = sentences[currentCategory][index];

            const headingEnd = sentence.indexOf(": ");
            if (headingEnd !== -1) {
                const sentencePart = sentence.substring(headingEnd + 2);
                fullSentence.innerHTML = sentencePart.replace(/\n/g, '<br>');
            } else {
                fullSentence.innerHTML = sentence.replace(/\n/g, '<br>');
            }

            overlay.style.display = "flex";
            overlay.dataset.sentenceIndex = index;
            overlay.dataset.categoryIndex = targetCategoryIndex; // Store category index
            event.stopPropagation();
        }

        function copyToClipboard(sentence) {
            const headingEnd = sentence.indexOf(": ");
            let sentenceToCopy = headingEnd !== -1 ? sentence.substring(headingEnd + 2) : sentence;

            // Remove ZWS if present
            sentenceToCopy = sentenceToCopy.replace(/\u200B/g, "");

            const textArea = document.createElement("textarea");
            textArea.value = sentenceToCopy;
            document.body.appendChild(textArea);
            textArea.select();
            document.execCommand("copy");
            document.body.removeChild(textArea);

            showPopupAnimation("Copied!");
        }


        function copyToClipboardPopup() {
            const textArea = document.createElement("textarea");
            let content = document.getElementById("full-sentence").textContent;
            // Remove ZWS
            content = content.replace(/\u200B/g, "");
            textArea.value = content;
            document.body.appendChild(textArea);
            textArea.select();
            document.execCommand("copy");
            document.body.removeChild(textArea);

            showPopupAnimation("Copied!");
        }
        function cancelAddCategory() {
            document.getElementById("new-category-input").value = ""; // Clear input field
            document.getElementById("add-category-form").style.display = "none"; // Hide the form
        }

        document.getElementById("add-category").addEventListener("click", () => {
            document.getElementById("add-category-form").style.display = "block";
        });
        function showNotification(message) {
            console.log(message);
            // You can replace the console.log with a custom notification implementation
            // or use a library for more advanced notifications.
        }

        function showPopupAnimation(message) {
            const popup = document.createElement("div");
            popup.className = "popup";
            popup.textContent = message;

            document.body.appendChild(popup);

            setTimeout(() => {
                document.body.removeChild(popup);
            }, 2000);
        }

        function saveToLocalStorage() {
            localStorage.setItem('sentences', JSON.stringify(sentences));
        }

        function backupData() {
            const dataToBackup = JSON.stringify({ sentences, categories }); // Include both sentences and categories
            const blob = new Blob([dataToBackup], { type: 'application/json' });
            const link = document.createElement('a');
            link.href = URL.createObjectURL(blob);
            link.download = 'sentences_backup.json';
            link.click();
        }
        function restoreData() {
            const input = document.createElement('input');
            input.type = 'file';
            input.accept = '.json';
            input.onchange = function (event) {
                const file = event.target.files[0];
                if (file) {
                    const reader = new FileReader();
                    reader.onload = function (e) {
                        const jsonData = e.target.result;
                        try {
                            const restoredData = JSON.parse(jsonData);
                            if (typeof restoredData === 'object') {
                                // Check if both sentences and categories exist in the restored data
                                if (restoredData.sentences && restoredData.categories) {
                                    sentences = restoredData.sentences;
                                    categories = restoredData.categories;
                                    saveToLocalStorage();
                                    renderCategories(); // Re-render categories as well
                                    renderSentences();
                                    showNotification('Data restored successfully.');
                                } else {
                                    showNotification('Invalid data format.');
                                }
                            } else {
                                showNotification('Invalid data format.');
                            }
                        } catch (error) {
                            showNotification('Error restoring data.');
                        }
                    };
                    reader.readAsText(file);
                }
            };
            input.click();
        }
        function showCategoryOptions() {
            document.getElementById("category-options").style.display = "block";
        }

        // Function to hide category options
        function hideCategoryOptions() {
            document.getElementById("category-options").style.display = "none";
        }

        function deleteCategory() {
            const confirmation = confirm("Are you sure you want to delete this category?");
            if (confirmation) {
                const currentCategory = categories[currentCategoryIndex];
                delete sentences[currentCategory];
                categories.splice(currentCategoryIndex, 1);
                localStorage.setItem('categories', JSON.stringify(categories));
                localStorage.setItem('sentences', JSON.stringify(sentences));
                // Refresh the page
                location.reload(true); // Pass true to force a hard refresh
            }
        }

        function showRenameCategoryModal() {
            const currentCategory = categories[currentCategoryIndex];
            document.getElementById("new-category-name").value = currentCategory;
            document.getElementById("rename-category-modal").style.display = "block";
        }

        function closeRenameCategoryModal() {
            document.getElementById("rename-category-modal").style.display = "none";
        }

        function renameCategory() {
            showRenameCategoryModal();
        }

        function confirmRenameCategory() {
            const newCategoryName = document.getElementById("new-category-name").value.trim();
            if (newCategoryName && newCategoryName.trim() !== "") {
                sentences[newCategoryName] = sentences[categories[currentCategoryIndex]];
                delete sentences[categories[currentCategoryIndex]];
                categories[currentCategoryIndex] = newCategoryName;
                localStorage.setItem('categories', JSON.stringify(categories));
                localStorage.setItem('sentences', JSON.stringify(sentences));
                renderCategories();
                renderSentences();
                closeRenameCategoryModal();
            }
        }

        function selectCategory(index) {
            // Update currentCategoryIndex to the newly selected category index
            currentCategoryIndex = index;

            // Remove selected class from previously selected category
            if (currentSelectedCategory !== null) {
                const previousSelectedCategory = document.getElementsByClassName("category")[currentSelectedCategory];
                previousSelectedCategory.classList.remove("selected");
            }

            renderSentences();
            showCategoryOptions();

            // Add selected class to the newly selected category
            const selectedCategory = document.getElementsByClassName("category")[currentCategoryIndex];
            selectedCategory.classList.add("selected");

            // Update currentSelectedCategory to the newly selected category index
            currentSelectedCategory = index;
        }
        document.addEventListener("DOMContentLoaded", () => {
            renderCategories();
            renderSentences();
            document.querySelectorAll('.sentence-options').forEach((element, index) => {
                element.addEventListener('click', (event) => showOptions(event, index, currentCategoryIndex));
            });
        });
    </script>
</body>

</html>